unit soko_lv;

//---------------------- INTERFACE ---------------------------------------------

interface

//----------------------

const

S_WAL   = ord('#'); // wall
S_GRA   = ord('x'); // grass
S_PLA   = ord('@'); // player
S_PLD   = ord('+'); // player on deck
S_DEC   = ord('.'); // deck
S_CRA   = ord('$'); // crate
S_CRD   = ord('*'); // crate on deck
S_FLO   = ord(' '); // floor


MAX_X   = 20;
MAX_Y   = 12;
MIN_X   = 3;
MIN_Y   = 5;

SCR_ROW = 40;

SET_SIZE = 37;

//----------------------

var

lvX, lvY         : byte;
playerX, playerY : byte;
crates           : byte;
level            : PChar;
board            : array[0..MAX_Y-1, 0..MAX_X-1] of byte;
centered         : word;

//----------------------

procedure getLv(lv: word);

//---------------------- IMPLEMENTATION ----------------------------------------

implementation

//----------------------

uses atari;

//----------------------

var

levels : array[0..SET_SIZE] of PChar = (
#19#11'xxxx#####xxxxxxxxxxxxxx#   #xxxxxxxxxxxxxx#$  #xxxxxxxxxxxx###  $##xxxxxxxxxxx#  $ $ #xxxxxxxxx### # ## #xxx#######   # ## #####  ..## $  $          ..###### ### #@##  ..#xxxx#     #########xxxx#######xxxxxxxx',
#14#10'############xx#..  #     ####..  # $  $  ##..  #$####  ##..    @ ##  ##..  # #  $ ######## ##$ $ #xx# $  $ $ $ #xx#    #     #xx############',
#17#10'xxxxxxxx########xxxxxxxxx#     @#xxxxxxxxx# $#$ ##xxxxxxxxx# $  $#xxxxxxxxxx##$ $ #xx######### $ # ####....  ## $  $  ###...    $  $   ##....  ##################xxxxxxxxx',
#12#11'######xx###x#..  #x##@###..  ###   ##..     $$ ##..  # # $ ##..### # $ ##### $ #$  #xxx#  $# $ #xxx# $  $  #xxx#  ##   #xxx#########',
#13#12'xxxxxxx#####xx#######   #### # @## $$ ##    $      ##  $  ###   #### #####$#### $  ### ..#x# $ $ $ ...#x#    ###...#x# $$ #x#...#x#  ###x#####x####xxxxxxxxx',
#15#12'x#######xxxxxxxx#  #  #####xxx##  #  #...###x#  $#  #...  #x# $ #$$ ...  #x#  $#  #... .#x#   # $##########$       $ $ ###  #  $$ #   #x######  ##$$@#xxxxxx#      ##xxxxxx########x',
#11#11'xxxxxx####x####### @#x#     $  #x#   $## $#x##$#...# #xx# $...  #xx# #. .# ##x#   # #$ #x#$  $    #x#  #######x####xxxxxx',
#19#11'xxxxxxxx#######xxxxxxxx#####  #  ####xxxxx#   #   $    #xx#### #$$ ## ##  #x##      # #  ## ####  ### $#$  $  $  ##...    # ##  #   ##...#    @ # ### ###...#  ###  $  $  #########x##   #   #xxxxxxxxxx#########',
#18#11'xxxxxxxxx####xxxxxx#########  ##xxxx##  $      $ ######   ## ##   ##...## #$$ $ $$#$##...## #   @   #   ...##  $# ###$$   ...## $  $$  $ ##....####$       #######xx#  #######xxxxxxxx####xxxxxxxxxxxx',
#14#12'x#########xxxxx#       #xxxxx# $ $$ $#xxxx### #  $ #xxxx#.#   $$ ##xxx#.###   $ #xxx#.#. $ ## #####...  $## $  ##...$   $    ##..###$### #@##..#x#     #######x#######xx',
#20#12'#####################                #### $#   $ ##  $    ###    $###    # $$ ###.###     $ $ ##  ###...#  #  #    #$  ##..##$$#### $  #   ##...#      $ ##  ####...$  ###  #    # ###..  $#  ##   ##@ ####.#              #####################',
#20#12'#####################   #    #   #   #@## $      $   $   # ### ###..## ###     ##   #....#$#  $### ## $ #....#  $  $ $ ##   #....# # # $ $ ##   ##..##   #$#   ###$##    ##  #  #$###   $  $     #  #  ##   #    #   #     #####################',
#20#12'#####################    @##      #   ###    ##    $    $ ###  ###....# # #  ####   #....# # # $   #### #...#  #       ###  ##.#     $   $ ###  $ $ ###  # # ##### $       # # $   ##### $  $# # # # $ #####         # #  ######################',
#20#12'#####################  #  ##    #   @#####    $    # $###  ###$# $ ##$# $ $    ##   $#    $      #### ##   $ ###  #....## # $# # # # #....###    $ $ #  #....#####$ ###  $ #....#####  # $        #######      # #    ##########################',
#20#12'#####################@     ###   #  #  ## # #  #  $  $     ######     # $ $#$# ##.#..#    ##$ $    ##.....    $   #   ###.....    ###$##$####.#..#    $    #   ######     #  #$  $ ######  #  $    $ $ ######  #  #  #  #  #####################',
#20#12'######################...   ## #    #  ##....         $ ## ##....# # #$###$    ##...#    #       # ###.#  #$ #     $## ##  #  # $ $ ###  $ ##     $  $ #  # ## ### # ## #$$# $#  # ##  #   $ $ #      ###    #     #  #   @#####################',
#20#12'#####################   #  #@# ##  ###### # #  $    $  ###### #    ###### $  ####   #  #....#  $$  ###$##$##....#      ##      #....##$##$###  $$  #....#      ## $  $  #  #  ###  ######  $   $    $  ###### #    #  #   ######################',
#20#12'##################### #     #          ##       $  ## ### #######  ##   $  $   ###..##  # # $ # #  ##....  $     ##$# ###....  $#####   #$####..# #  #   #  $  ####.# #  $   $  # @###  $  $ #   #  ######       ###############################',
#20#12'#####################     ###..###     ## $$  ###..###  $@ ##  # ##......#  $  ##     #......#  $  #####  ###..######$ ##   $$$ #..#    #  ## $#   $  $  $$ #$ ##  #  ## $  ##  #  ## $    $ ## $    $ ##  #  ##    ##  #  #####################',
#20#12'#####################    #  # #  #  #  ## @# # ## $   $   ###### #    #  # $   ##    # ## #$ ## ## ##      $   $   $   ##..###$$## $##$ ## ##..#.#  # $   $ #  ##....# $$   ##$ #####....#  #####      ##...###        ##  #####################',
#20#12'#####################....#       #  #  ##....# # $  $      ##.... ##  $# # $#$ ##...#   $   $#  $  ##..####  # $   $$  ##      #### #### ####        #   #     ## ##   #   $ # $ $ ## ##    $ ## $  $  ##     @#     #   # #####################',
#20#12'#####################....###           ##....##### #  #$# ###....###   #$  $   ##....###    $  #$$####  #### $#  #$ $  ###  ####  $  $  #  ##@  ####$###$## $  ###        #  #  $  ###   ###  #  $  ############  #  #     #####################',
#20#12'#####################     #     @#...####     #      ##...### # # ##$## ## ....##   $ #   $$$  ....####$### $$  ### ##.##     $  #    # #####  $  #  ###  # #  ### #$##    $  $$   ##   $ ##   #  # #  ##     #    #  #    #####################',
#20#12'#####################     #  #...#@    ## #       ....#    ##  $  #   #....#   ## ##$#### ##....#  ## $   $  #  #...#  ## $$ #   #   # $$  ####  $$$#   $$  $  ## $  #  #    # $#  ##   $#  #       $  ##  #    #    #  #  #####################',
#20#12'#########################@###.##...##  ######$  ..#...#    #####    ......#  $ ####  $ #.....## # ####  $$# #####  $ $ ### $# $    ##  $$  ###  #  #    # $  $ ###   $$ ### #$##   ### $#      $ $  $ #####    #    #    #######################',
#20#12'#####################@     #   #       ### ### ##  #### # ###    # #  $$       ##  # # # $ # $ ## ###     $ #  #$$ #   ##  ###  #      ## ###..#.# $ #  $ #    ##..#.#  $ # ## $$  ##....##   $$  $  # ##.....##        #  #####################',
#20#12'#####################  #      #   #   ### $# $ $ ##...$  $ ##  $  # ##....# $  ## ## $ ##....#   $ ## $    #....## $   ## $##  #...#       ##   $$$##$##  ### ### # #  #   #  #    ## $ #  $  ##       ##    #    #@       #####################',
#20#12'#####################  #  # #    #  #  ##   $      $ $     ### #  #$###$##  ## ##   $     $  #  $  ## ###$##$#   # $   ## #   $ $  ###### $## $  $$ $  #@#.#...## #     #  # #.#...## ########## #.....##            #.....#####################',
#20#12'#####################  #     #  ##    ### $#   $ #     ##  ## $  $  #..#     $ ## $ $  #....#   # ### $#  #......### $ ##   #  #....#  #$  ## $  ####..#   #   ### $   ## # # $  $##### $    $#@$ $#   #####   #       #   #####################',
#20#12'#####################      ....#    #####      ....        ## # ##########     ## #$   #      ###..##  $   #$$###   #..## $ ### $   $   #..## $ #   $ $ #  ##..##  #  $$ # $ ##   ###@## $#  $  $     ####       ##   #  #######################',
#20#12'#####################        #   #@ #  ## $$  #$$# # #  ## ##  # $ $ #$$ #     ### #  #  # # #  #  ##   ##       #     ##   # $ #   #   #  ## $ #$ #   #  $ #..###$ #  ####    #...##  $          #....##   #  #     #.....#####################',
#20#12'#####################     #   #####    ### $  #   ####  $  ##### $$   #..#  #  ##  $  $  ##..#### ### $   ###....   $$ ##  #$#   ....# # $ ## #  # $ ..###$#   ## #   $ #..#   ##  ##   $#  ####   # $### #  #    @#      ######################',
#20#12'#####################   #   #    #   #@##   $  $     # $ # ###$# $### #    $$# ##  #  #.###  #$ $  ##  #$#....#  # ### ## $  #.....##    # ###$  #.#....#$$ $  ##  ######..## #  # ##  $         $ ### ##   #   #        # #####################',
#20#12'##################### # # #   #@##   # ##             $    ##  ##$# ##### $ # ####    ##.....#  #  ###$##$#.....###$#$ ##   # ##.....#  # ###  $    ##..##  #  ## $ #   $   $  $$$ ### $  $# #  #  $   ##   ##   #  #      #####################',
#19#12'xxxxxxx###########xxxxxxxx#         #xxxxxxxx#    $ $  #x######x# $ ##### #x#    ##### $  ##$#x#       $ $      #x#          ## ## #x#    ##@##### ## #x#    ####xxx# ## ###....#xxxxxx# $   ##....#xxxxxx#     #######xxxxxx#######',
#19#12'#############xxxxxx#           #xxxxxx# ### $$    #xxxxxx#   # $  $  #xxxxxx#  $####$######xxxx# $ ##        ######  $$ $        ...#### ## $$#     ...#xx# ##   #     ...#xx#      #     ...#xx###@#############xxxx###xxxxxxxxxxxx',
#16#12'#######xxxxxxxxx#     ###########     #    #  ### $   #   $ $  ##  $  #  $ ##  ## $$  ##$ $    ### #  ## ######### #  ##    ...##  #$       ...##   $$      ...##     ##@#  ...#################',
#17#10'################x#       #@ #   #x# # # # # $  $$#x# #...# #$$$   #x#  ...# # $  $$### ##.## # ##    ## #...     $    ## ## ###  ########    #x####xxxxxx######xxxxxxxxxxx'
);

//----------------------

procedure getLv(lv: word);
var
  iX, iY : byte;
  offset : byte;
  row    : byte;
  tmpChr : byte;
begin
  offset := 0;
  crates := 0;

  level := levels[lv];
  lvX   := ord(level[0]) - 1;
  lvY   := ord(level[1]) - 1;
  level := levels[lv] + 2;
  row   := lvX + 1;

  centered := savmsc + (((MAX_Y - (lvY + 1)) shr 1) * (SCR_ROW * 2)) + ((MAX_X -(lvX + 1)));

  for iY := 0 to lvY do begin
    for iX := 0 to lvX do begin
      tmpChr := ord(level[offset + iX]);

      if (tmpChr = S_PLA) or (tmpChr = S_PLD) then begin
        playerX := iX;
        playerY := iY
      end;

      if tmpChr = S_CRA then inc(crates);

      board[iY][iX] := tmpChr;
    end;
    inc(offset, row);
  end;
end;

//---------------------- INITIALIZATION ----------------------------------------

initialization
end.
